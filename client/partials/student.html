<iframe style="position: fixed; display: block; width: 0px; height: 0px; visibility: hidden; right: 0;" id="iframe" name="iframe">
</iframe>

<div ng-include src="top_bar_url"></div>
<div class="row-fluid content">

    <div class="span4">
        <div class="menu shadow">
            <div>
                <a href="#" ng-click="reload();" class="text-right">Refresh Activity Logs <i class="icon-refresh"></i></a>
            </div>
            <ul>
                <li>
                    <select ng-model="mode" class="edit-field" ng-change="reload();" style="width: 96%; margin: 2%;">
                        <option ng-repeat="m in modes.modes">{{m}}</option>
                    </select>
                </li>
                <li ng-repeat="al in menu" ng-class="isSelectedAl(al.id)">
                    <a href="#" ng-click="selectAL(al.id);">
                        {{DB.d.users[DB.m.als[al.id].user[0]].username}} - {{al.title}}
                        <i ng-show="DB.m.als[al.id].mode == 'edit'" class="icon-pencil"></i>
                    </a>
                    <div class="functions">
                        <button class="btn-link function" ng-click="deleteAl(false, al.id);" ng-hide="DB.m.als[al.id].mode == 'deleting' || DB.m.als[al.id].mode == 'edit'"><i class="icon-remove"></i></button>
                    </div>
                    <div class="confirms">
                        <button class="btn btn-danger confirm" ng-click="deleteAl(true, al.id);" ng-show="DB.m.als[al.id].mode == 'deleting';">Delete</button>
                        <button class="btn btn-success confirm" ng-click="DB.m.als[al.id].mode = 'normal';" ng-show="DB.m.als[al.id].mode == 'deleting';">Keep</button>
                    </div>
                </li>
                <!--<li ng-show="new_project != null" ng-class="isSelectedProject(-1)">-->
                    <!--<a href="#" ng-click="selectProject(-1);">{{new_project.name}} <i class="icon-edit"></i></a>-->
                <!--</li>-->
            </ul>
            <div>
                <!--<a href="#" class="text-right">-->
                    <!--{{selected_al == null}}-->
                <!--</a>-->
            </div>
        </div>
    </div>

    <div class="span8" ng-show="isNewAl();">
        <form id="alform" ng-submit="submitNewAl();" class="" target="iframe" action='/activity_logs' method='POST' enctype='multipart/form-data'>
        <div class="menu shadow">
            <div>
                <span>
                    <input autofocus="true" onload="this.focus()" type="text" class="input-xxlarge" placeholder="Title" name="data[ActivityLog][title]">
                </span>
            </div>
            <ul>
                <li>
                    <div class="selector">
                        <!--<textarea class="edit-field" ng-model="new_activity_log.content" name="data[ActivityLog][title]"></textarea>-->
                        <div class="control-group">
                            <!--<label class="control-label" for="data[ActivityLog][content]">Content</label>-->
                            <div class="controls">
                                <textarea name='data[ActivityLog][content]' placeholder="Content"></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="data[ActivityLog][visibility_level]">Visibility level</label>
                            <div class="controls">
                                <select name='data[ActivityLog][visibility_level]'>
                                    <option selected>PRIVATE</option>
                                    <option>SUPERVISOR</option>
                                    <option>TEAM</option>
                                    <option>PUBLIC</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <label class="checkbox">
                                    <input name='data[ActivityLog][question]' type="checkbox"> Question
                                </label>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="controls">
                                <label class="cont rol-label" for="data[ActivityLog][visibility_level]">Files</label>
                            </div>
                        </div>
                        <div class="control-group" ng-repeat="file in files">
                            <div class="controls">
                                <input type='file' name='data[Media][{{$index}}]' >
                                <span class="btn btn-link" ng-click='removeFile($index);'><button class="btn btn-mini btn-warning"><i class="icon-remove"></i></button></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <span tabindex="-1" class="btn" ng-click='addFile();'><i class="icon-file"></i> add file</span>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            <div>
                <span>
                    <div class="btn-group">
                        <button ng-disabled="BUSY.busy();" type="submit" class="btn">Save</button>
                        <button ng-disabled="BUSY.busy();" type="button" class="btn" ng-click="removeNewAl();">Cancel</button>
                    </div>
                </span>
            </div>
        </div>
        </form>
    </div>

    <div class="span8" ng-hide="isNewAl();">
        <div class="menu shadow" ng-show="isSelectedAl();">
            <div>
                <span>
                    <h4 class="clickable" ng-hide="DB.m.als[selected_al].mode == 'edit'" ng-click="editAl(selected_al);">
                        {{DB.d.als[selected_al].title}} <i class="icon-pencil"></i>
                        <!--{{DB.d.als[selected_al].modified}} / {{DB.d.als[selected_al].created}}-->
                    </h4>
                    <!-- EDIT MODE -->
                    <span ng-show="DB.m.als[selected_al].mode == 'edit'">
                        <input autofocus="true" onload="this.focus()" type="text" class="input-xxlarge" ng-model="DB.d.als[selected_al].title">
                    </span>
                </span>
            </div>
            <ul>
                <li>
                    <p class="selector" ng-hide="DB.m.als[selected_al].mode == 'edit'">
                        {{DB.d.als[selected_al].content}}
                    </p>
                    <!-- EDIT MODE -->
                    <textarea class="edit-field" ng-model="DB.d.als[selected_al].content" ng-show="DB.m.als[selected_al].mode == 'edit'"></textarea>
                </li>
            </ul>
            <div ng-show="DB.m.als[selected_al].mode == 'edit'">
                <span>
                    <div class="btn-group">
                        <button ng-disabled="BUSY.busy();" type="submit" class="btn" ng-click="saveAl(selected_al);">Save</button>
                        <button ng-disabled="BUSY.busy();" type="button" class="btn" ng-click="cancelEditAl(selected_al);">Cancel</button>
                    </div>
                </span>
            </div>
            <div ng-show="isSelectedAl();">
                <a href="#" ng-click="toggleShowInfo(selected_al);">
                    <strong>Info</strong>
                    <i class="icon-circle-arrow-right" ng-hide="showInfo(selected_al);"></i>
                    <i class="icon-circle-arrow-down" ng-show="showInfo(selected_al);"></i>
                </a>
            </div>
            <ul ng-show="showInfo(selected_al);">
                <li>
                    <span class="selector">
                        <p ng-show="DB.d.users[DB.d.als[selected_al].id].id == user.User.id"><strong>user:</strong> You</p>
                        <p ng-hide="DB.d.users[DB.d.als[selected_al].id].id == user.User.id"><strong>user:</strong> {{DB.d.users[DB.d.als[selected_al].id].username}}</p>
                        <p><strong>created:</strong> {{DB.d.als[selected_al].created}}<br></p>
                        <p><strong>modified:</strong> {{DB.d.als[selected_al].modified}}</p>
                    </span>
                </li>
            </ul>
            <div ng-show="isSelectedAl();">
                <a href="#" ng-click="toggleShowMedia(selected_al);">
                    <strong>Media</strong>
                    <span class="badge" ng-show="DB.m.als[selected_al].media != null && DB.m.als[selected_al].media.length > 0;" style="float: right">
                        {{DB.m.als[selected_al].media.length}}
                    </span>
                    <i class="icon-circle-arrow-right" ng-hide="showMedia(selected_al);"></i>
                    <i class="icon-circle-arrow-down" ng-show="showMedia(selected_al);"></i>
                </a>
            </div>
            <ul>
                <li ng-show="showMedia(selected_al) && (DB.m.als[selected_al].media == null || DB.m.als[selected_al].media.length == 0);">
                    <div class="selector"><em>No Media present...</em></div>
                </li>
                <li ng-show="showMedia(selected_al) && (DB.m.als[selected_al].media != null && DB.m.als[selected_al].media.length > 0);">
                    <ul class="thumbnails">
                        <li ng-repeat="m in DB.m.als[selected_al].media" class="span3" style="margin: 3px">
                            <div class="thumbnail">
                                <img src="/media/download/{{m}}?thumb=BIG" alt="{{DB.d.media[m].filename}}" ng-show="DB.d.media[m]['content-type'].indexOf('image/') == 0">
                                <img src="{{getThumbUrl(DB.d.media[m]['content-type']);}}" alt="{{DB.d.media[m].filename}}" ng-hide="DB.d.media[m]['content-type'].indexOf('image/') == 0">
                                <p>{{DB.d.media[m].filename}}</p>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
            <div ng-show="isSelectedAl();">
                <a href="#" ng-click="toggleShowComments(selected_al);">
                    <strong>Comments</strong>
                    <span class="badge" ng-show="DB.m.als[selected_al].comments != null && DB.m.als[selected_al].comments.length" style="float: right">
                        {{DB.m.als[selected_al].comments.length}}
                    </span>
                    <i class="icon-circle-arrow-right" ng-hide="showComments(selected_al);"></i>
                    <i class="icon-circle-arrow-down" ng-show="showComments(selected_al);"></i>
                </a>
            </div>
            <ul>
                <li ng-show="showComments(selected_al) && (DB.m.als[selected_al].comments == null || DB.m.als[selected_al].comments.length == 0);">
                    <div class="selector"><em>No Comments yet...</em></div>
                </li>
                <li ng-repeat="c in DB.m.als[selected_al].comments" ng-show="showComments(selected_al);">
                    <p class="selector">{{DB.d.comments[c].content}}</p>
                    <ul class="thumbnails">
                        <li ng-repeat="m in DB.m.comments[c].media" class="span3" style="margin: 3px">
                            <div class="thumbnail">
                                <img src="/media/download/{{DB.d.media[m].id}}?thumb=BIG" alt="{{DB.d.media[m].filename}}" ng-show="DB.d.media[m]['content-type'].indexOf('image/') == 0">
                                <img src="{{getThumbUrl(DB.d.media[m]['content-type']);}}" alt="{{DB.d.media[m].filename}}" ng-hide="DB.d.media[m]['content-type'].indexOf('image/') == 0">
                                <p>{{DB.d.media[m].filename}}</p>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>

        <!--<div class="menu shadow" ng-show="selected_project<0;">-->
            <!--<div>-->
                <!--<span>-->
                    <!--&lt;!&ndash; EDIT MODE &ndash;&gt;-->
                    <!--<span><input autofocus="true" onload="this.focus()" type="text" class="input-xxlarge" ng-model="new_project.name"></span>-->
                <!--</span>-->
            <!--</div>-->
            <!--<ul>-->
                <!--<li>-->
                    <!--&lt;!&ndash; EDIT MODE &ndash;&gt;-->
                    <!--<textarea class="edit-field" ng-model="new_project.description"></textarea>-->
                <!--</li>-->
            <!--</ul>-->
            <!--<div>-->
                <!--<span>-->
                    <!--<div class="btn-group">-->
                        <!--<button ng-disabled="BUSY.busy();" type="submit" class="btn" ng-click="saveProject(selected_project);">Save</button>-->
                        <!--<button ng-disabled="BUSY.busy();" type="button" class="btn" ng-click="cancelEditProject(selected_project);">Cancel</button>-->
                    <!--</div>-->
                <!--</span>-->
            <!--</div>-->
        <!--</div>-->

        <!--<div class="row-fluid">-->

            <!--<div class="span4">-->
                <!--<div class="menu shadow">-->
                    <!--<div class="text-right">-->
                        <!--<span><strong>Teams <i class="icon-briefcase"></i></strong></span>-->
                    <!--</div>-->
                    <!--<ul>-->
                        <!--<li ng-repeat="t in menu[findProjectIndexById(selected_project)].teams" ng-class="isSelectedTeam(t.id)">-->
                            <!--<a href="#" ng-click="selectTeam(t.id);">{{DB.d.teams[t.id].name}}</a>-->
                            <!--<div class="functions">-->
                                <!--<button class="btn-link function" ng-click="deleteTeam(false, t.id);" ng-hide="DB.m.teams[t.id].mode == 'deleting' || DB.m.teams[t.id].mode == 'edit'"><i class="icon-remove"></i></button>-->
                            <!--</div>-->
                            <!--<div class="confirms">-->
                                <!--<button class="btn btn-danger confirm" ng-click="deleteTeam(true, t.id, selected_project);" ng-show="DB.m.teams[t.id].mode == 'deleting';">Delete</button>-->
                                <!--<button class="btn btn-success confirm" ng-click="DB.m.teams[t.id].mode = 'normal';" ng-show="DB.m.teams[t.id].mode == 'deleting';">Keep</button>-->
                            <!--</div>-->
                        <!--</li>-->
                        <!--<li ng-show="new_team != null" ng-class="isSelectedTeam(-1);" ng-click="selectTeam(-1);">-->
                            <!--<input class="edit_field" placeholder="New Team..." onfocus="this.focus()" autofocus="true" ng-model="new_team.name">-->
                        <!--</li>-->
                    <!--</ul>-->
                    <!--<div class="text-right">-->
                        <!--<a href="#" class="text-right">-->
                            <!--&lt;!&ndash;<button ng-click="newProject();" ng-disabled="new_project != null" class="btn btn-success">New Project</button>&ndash;&gt;-->
                            <!--<button ng-click="newTeam(selected_project);" class="btn btn-success" ng-show="new_team == null;">New Team</button>-->
                            <!--<button ng-click="newTeam(true);" class="btn btn-warning" ng-show="new_team != null;">Create</button>-->
                            <!--<button ng-click="cancelNewTeam();" class="btn btn-success" ng-show="new_team != null;">Cancel</button>-->
                        <!--</a>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="span4" ng-show="selected_team != null && selected_team > 0;">-->
                <!--<div class="menu shadow">-->
                    <!--<div class="text-right">-->
                        <!--<span><strong>Team Members <i class="icon-user"></i></strong></span>-->
                    <!--</div>-->
                    <!--<ul>-->
                        <!--<li ng-repeat="u in menu[findProjectIndexById(selected_project)].teams[findTeamIndexById(selected_project, selected_team)].users">-->
                            <!--<a>{{DB.d.users[u.id].username}}</a>-->
                            <!--<div class="functions">-->
                                <!--<button class="btn-link function" ng-click="removeMember(false, u.id, selected_team);" ng-hide="DB.m.users[u.id].mode == 'deleting' || DB.m.users[u.id].mode == 'edit'"><i class="icon-remove"></i></button>-->
                            <!--</div>-->
                            <!--<div class="confirms">-->
                                <!--<button class="btn btn-danger confirm" ng-click="removeMember(true, u.id, selected_team);" ng-show="DB.m.users[u.id].mode == 'deleting';">Remove Member</button>-->
                                <!--<button class="btn btn-success confirm" ng-click="DB.m.users[u.id].mode = 'normal';" ng-show="DB.m.users[u.id].mode == 'deleting';">Keep</button>-->
                            <!--</div>-->
                        <!--</li>-->
                    <!--</ul>-->
                    <!--<div class="text-right">-->
                        <!--<span><button ng-click="addMember(false, selected_team);" ng-disabled="add_member" class="btn btn-success">Add Member</button></span>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="span4" ng-show="add_member && selected_team > 0;">-->
                <!--<div class="menu shadow">-->
                    <!--<div class="text-right">-->
                        <!--<span><strong>Add Memeber <i class="icon-plus"></i></strong></span>-->
                    <!--</div>-->
                    <!--<ul>-->
                        <!--<li ng-repeat="u in DB.d.users | filter:'s.'">-->
                            <!--<a href="#" ng-click="addMember(true, add_member_to, u.id)">-->
                                <!--{{u.username}}-->
                            <!--</a>-->
                        <!--</li>-->
                    <!--</ul>-->
                    <!--<div class="text-right">-->
                        <!--<span><button ng-click="cancelAddMember();" class="btn btn-warning">Close</button></span>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
            <!---->
        </div>
    </div>

</div>